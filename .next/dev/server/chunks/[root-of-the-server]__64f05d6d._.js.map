{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sheen%20Milger%20Ochavo/Desktop/scanner/Bisdak/bisdak/app/api/parse/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { execSync } from \"child_process\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport os from \"os\";\r\n\r\nexport async function POST(req) {\r\n  try {\r\n    const code = await req.text();\r\n    \r\n    if (!code || code.trim() === \"\") {\r\n      return NextResponse.json({ \r\n        error: \"No code provided\" \r\n      });\r\n    }\r\n\r\n    // Create temp file\r\n    const tempDir = os.tmpdir();\r\n    const tempFile = path.join(tempDir, `bisaya_${Date.now()}.txt`);\r\n    fs.writeFileSync(tempFile, code);\r\n\r\n    // Path to parser.exe\r\n    const parserPath = path.join(process.cwd(), \"public\", \"parser.exe\");\r\n    \r\n    // Check if parser exists\r\n    if (!fs.existsSync(parserPath)) {\r\n      return NextResponse.json({ \r\n        error: \"Compiler not found. Please ensure parser.exe is in the public folder.\" \r\n      });\r\n    }\r\n\r\n    // Execute and capture both stdout and stderr\r\n    let output = \"\";\r\n    try {\r\n      // Use 2>&1 to capture stderr as well\r\n      output = execSync(`\"${parserPath}\" \"${tempFile}\" 2>&1`, {\r\n        encoding: \"utf8\",\r\n        timeout: 10000, // 10 second timeout\r\n        maxBuffer: 1024 * 1024 * 10, // 10MB buffer\r\n      });\r\n    } catch (execError) {\r\n      // Execution error (non-zero exit code)\r\n      if (execError.status !== 0) {\r\n        // The error output is in execError.stderr or execError.stdout\r\n        output = execError.stdout || execError.stderr || execError.message;\r\n      } else {\r\n        // Other errors (like timeout)\r\n        throw execError;\r\n      }\r\n    }\r\n\r\n    // Clean up temp file\r\n    try {\r\n      fs.unlinkSync(tempFile);\r\n    } catch (cleanupError) {\r\n      console.warn(\"Could not delete temp file:\", cleanupError.message);\r\n    }\r\n\r\n    // Parse the output to separate errors from regular output\r\n    const lines = output.split('\\n');\r\n    const errorLines = [];\r\n    const outputLines = [];\r\n    \r\n    for (const line of lines) {\r\n      if (line.includes(\"Error:\") || \r\n          line.includes(\"Syntax error:\") || \r\n          line.includes(\"Unexpected character:\") ||\r\n          line.includes(\"Type error:\") ||\r\n          line.includes(\"not defined\") ||\r\n          line.startsWith(\"Error\") ||\r\n          line.includes(\"error\")) {\r\n        errorLines.push(line);\r\n      } else {\r\n        outputLines.push(line);\r\n      }\r\n    }\r\n    \r\n    const fullOutput = outputLines.join('\\n');\r\n    const errorOutput = errorLines.join('\\n');\r\n    \r\n    // If there are error lines and no successful output markers\r\n    if (errorLines.length > 0 && \r\n        !fullOutput.includes(\"=== STARTING COMPILATION ===\") &&\r\n        !fullOutput.includes(\"=== Code Execution Successful ===\")) {\r\n      return NextResponse.json({ \r\n        error: errorOutput || \"Compilation failed\",\r\n        output: fullOutput \r\n      });\r\n    }\r\n\r\n    // Return the output (errors might be mixed in but we'll let frontend handle it)\r\n    return NextResponse.json({ \r\n      error: null, \r\n      output: output \r\n    });\r\n\r\n  } catch (err) {\r\n    console.error(\"API Error:\", err);\r\n    \r\n    let errorMessage = err.message;\r\n    if (err.code === \"ETIMEDOUT\" || err.signal === \"SIGTERM\") {\r\n      errorMessage = \"Execution timed out. Check for infinite loops or large computations.\";\r\n    } else if (err.code === \"ENOENT\") {\r\n      errorMessage = \"Compiler (parser.exe) not found in public folder.\";\r\n    } else if (err.code === \"ENOBUFS\") {\r\n      errorMessage = \"Output too large. Check for infinite loops.\";\r\n    }\r\n    \r\n    return NextResponse.json({\r\n      error: `‚ùå Server Error: ${errorMessage}`,\r\n      output: \"\"\r\n    }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,CAAC,QAAQ,KAAK,IAAI,OAAO,IAAI;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT;QACF;QAEA,mBAAmB;QACnB,MAAM,UAAU,wGAAE,CAAC,MAAM;QACzB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;QAC9D,wGAAE,CAAC,aAAa,CAAC,UAAU;QAE3B,qBAAqB;QACrB,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QAEtD,yBAAyB;QACzB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT;QACF;QAEA,6CAA6C;QAC7C,IAAI,SAAS;QACb,IAAI;YACF,qCAAqC;YACrC,SAAS,IAAA,+HAAQ,EAAC,CAAC,CAAC,EAAE,WAAW,GAAG,EAAE,SAAS,MAAM,CAAC,EAAE;gBACtD,UAAU;gBACV,SAAS;gBACT,WAAW,OAAO,OAAO;YAC3B;QACF,EAAE,OAAO,WAAW;YAClB,uCAAuC;YACvC,IAAI,UAAU,MAAM,KAAK,GAAG;gBAC1B,8DAA8D;gBAC9D,SAAS,UAAU,MAAM,IAAI,UAAU,MAAM,IAAI,UAAU,OAAO;YACpE,OAAO;gBACL,8BAA8B;gBAC9B,MAAM;YACR;QACF;QAEA,qBAAqB;QACrB,IAAI;YACF,wGAAE,CAAC,UAAU,CAAC;QAChB,EAAE,OAAO,cAAc;YACrB,QAAQ,IAAI,CAAC,+BAA+B,aAAa,OAAO;QAClE;QAEA,0DAA0D;QAC1D,MAAM,QAAQ,OAAO,KAAK,CAAC;QAC3B,MAAM,aAAa,EAAE;QACrB,MAAM,cAAc,EAAE;QAEtB,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,KAAK,QAAQ,CAAC,aACd,KAAK,QAAQ,CAAC,oBACd,KAAK,QAAQ,CAAC,4BACd,KAAK,QAAQ,CAAC,kBACd,KAAK,QAAQ,CAAC,kBACd,KAAK,UAAU,CAAC,YAChB,KAAK,QAAQ,CAAC,UAAU;gBAC1B,WAAW,IAAI,CAAC;YAClB,OAAO;gBACL,YAAY,IAAI,CAAC;YACnB;QACF;QAEA,MAAM,aAAa,YAAY,IAAI,CAAC;QACpC,MAAM,cAAc,WAAW,IAAI,CAAC;QAEpC,4DAA4D;QAC5D,IAAI,WAAW,MAAM,GAAG,KACpB,CAAC,WAAW,QAAQ,CAAC,mCACrB,CAAC,WAAW,QAAQ,CAAC,sCAAsC;YAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO,eAAe;gBACtB,QAAQ;YACV;QACF;QAEA,gFAAgF;QAChF,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,QAAQ;QACV;IAEF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,cAAc;QAE5B,IAAI,eAAe,IAAI,OAAO;QAC9B,IAAI,IAAI,IAAI,KAAK,eAAe,IAAI,MAAM,KAAK,WAAW;YACxD,eAAe;QACjB,OAAO,IAAI,IAAI,IAAI,KAAK,UAAU;YAChC,eAAe;QACjB,OAAO,IAAI,IAAI,IAAI,KAAK,WAAW;YACjC,eAAe;QACjB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO,CAAC,gBAAgB,EAAE,cAAc;YACxC,QAAQ;QACV,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}